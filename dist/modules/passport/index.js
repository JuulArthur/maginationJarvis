"use strict";
var LocalStrategy = require('passport-local').Strategy;
exports = module.exports = (function(passport, models) {
  passport.serializeUser((function(user, done) {
    done(null, user.username);
  }));
  passport.deserializeUser((function(user, done) {
    models.User.findOne({username: user.username}, (function(err, user) {
      done(err, user);
    }));
  }));
  passport.use('local', new LocalStrategy((function(username, password, done) {
    models.User.findOne({username: username}, (function(err, user) {
      if (err)
        return done(err);
      if (!user)
        return done(null, false, {message: 'Incorrect username.'});
      user.validPassword(password, (function(err, res) {
        if (!res)
          return done(null, false, {message: 'Incorrect password.'});
        return done(null, user);
      }));
    }));
  })));
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvcGFzc3BvcnQvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxBQUFJLEVBQUEsQ0FBQSxhQUFZLEVBQU0sQ0FBQSxPQUFNLEFBQUMsQ0FBQyxnQkFBZSxDQUFDLFNBQVMsQ0FBQztBQUV4RCxNQUFNLEVBQUksQ0FBQSxNQUFLLFFBQVEsSUFBSSxTQUFDLFFBQU8sQ0FBRSxDQUFBLE1BQUs7QUFHdEMsU0FBTyxjQUFjLEFBQUMsRUFBQyxTQUFDLElBQUcsQ0FBRyxDQUFBLElBQUcsQ0FBTTtBQUNuQyxPQUFHLEFBQUMsQ0FBQyxJQUFHLENBQUcsQ0FBQSxJQUFHLFNBQVMsQ0FBQyxDQUFDO0VBQzdCLEVBQUMsQ0FBQztBQUVGLFNBQU8sZ0JBQWdCLEFBQUMsRUFBQyxTQUFDLElBQUcsQ0FBRyxDQUFBLElBQUc7QUFDL0IsU0FBSyxLQUFLLFFBQVEsQUFBQyxDQUFDLENBQUUsUUFBTyxDQUFHLENBQUEsSUFBRyxTQUFTLENBQUUsR0FBRSxTQUFDLEdBQUUsQ0FBRyxDQUFBLElBQUcsQ0FBSztBQUMxRCxTQUFHLEFBQUMsQ0FBQyxHQUFFLENBQUcsS0FBRyxDQUFDLENBQUM7SUFDbkIsRUFBQyxDQUFDO0VBQ04sRUFBQyxDQUFDO0FBRUYsU0FBTyxJQUFJLEFBQUMsQ0FBQyxPQUFNLENBQUcsSUFBSSxjQUFZLEFBQUMsRUFDbkMsU0FBQyxRQUFPLENBQUcsQ0FBQSxRQUFPLENBQUcsQ0FBQSxJQUFHO0FBQ3BCLFNBQUssS0FBSyxRQUFRLEFBQUMsQ0FBQyxDQUFFLFFBQU8sQ0FBRyxTQUFPLENBQUUsR0FBRyxTQUFDLEdBQUUsQ0FBRyxDQUFBLElBQUc7QUFDakQsU0FBSSxHQUFFO0FBQUcsYUFBTyxDQUFBLElBQUcsQUFBQyxDQUFDLEdBQUUsQ0FBQyxDQUFDO0FBQUEsQUFDekIsU0FBSSxDQUFDLElBQUc7QUFBRyxhQUFPLENBQUEsSUFBRyxBQUFDLENBQUMsSUFBRyxDQUFHLE1BQUksQ0FBRyxFQUFFLE9BQU0sQ0FBRyxzQkFBb0IsQ0FBRSxDQUFDLENBQUM7QUFBQSxBQUN2RSxTQUFHLGNBQWMsQUFBQyxDQUFDLFFBQU8sR0FBRyxTQUFDLEdBQUUsQ0FBRyxDQUFBLEdBQUUsQ0FBSTtBQUNyQyxXQUFJLENBQUMsR0FBRTtBQUFHLGVBQU8sQ0FBQSxJQUFHLEFBQUMsQ0FBQyxJQUFHLENBQUcsTUFBSSxDQUFHLEVBQUUsT0FBTSxDQUFHLHNCQUFvQixDQUFFLENBQUMsQ0FBQztBQUFBLEFBQ3RFLGFBQU8sQ0FBQSxJQUFHLEFBQUMsQ0FBQyxJQUFHLENBQUcsS0FBRyxDQUFDLENBQUM7TUFDM0IsRUFBQyxDQUFDO0lBQ04sRUFBQyxDQUFDO0VBQ04sRUFDSixDQUFDLENBQUM7QUFLTixDQUFBLENBQUM7QUFBQSIsImZpbGUiOiJtb2R1bGVzL3Bhc3Nwb3J0L2luZGV4LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIiwic291cmNlc0NvbnRlbnQiOlsidmFyIExvY2FsU3RyYXRlZ3kgICA9IHJlcXVpcmUoJ3Bhc3Nwb3J0LWxvY2FsJykuU3RyYXRlZ3k7XG5cbmV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IChwYXNzcG9ydCxtb2RlbHMpID0+IHtcblxuXG4gICAgcGFzc3BvcnQuc2VyaWFsaXplVXNlcigodXNlciwgZG9uZSkgPT4ge1xuICAgICAgICBkb25lKG51bGwsIHVzZXIudXNlcm5hbWUpOyAvLyBhdHRhY2hlZCB0byB0aGUgc2Vzc2lvblxuICAgIH0pO1xuXG4gICAgcGFzc3BvcnQuZGVzZXJpYWxpemVVc2VyKCh1c2VyLCBkb25lKSA9PiB7XG4gICAgICAgIG1vZGVscy5Vc2VyLmZpbmRPbmUoeyB1c2VybmFtZTogdXNlci51c2VybmFtZSB9LChlcnIsIHVzZXIpID0+e1xuICAgICAgICAgICAgZG9uZShlcnIsIHVzZXIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIHBhc3Nwb3J0LnVzZSgnbG9jYWwnLCBuZXcgTG9jYWxTdHJhdGVneShcbiAgICAgICAgKHVzZXJuYW1lLCBwYXNzd29yZCwgZG9uZSkgPT4ge1xuICAgICAgICAgICAgbW9kZWxzLlVzZXIuZmluZE9uZSh7IHVzZXJuYW1lOiB1c2VybmFtZSB9LCAoZXJyLCB1c2VyKT0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gZG9uZShlcnIpO1xuICAgICAgICAgICAgICAgIGlmICghdXNlcikgcmV0dXJuIGRvbmUobnVsbCwgZmFsc2UsIHsgbWVzc2FnZTogJ0luY29ycmVjdCB1c2VybmFtZS4nIH0pO1xuICAgICAgICAgICAgICAgIHVzZXIudmFsaWRQYXNzd29yZChwYXNzd29yZCwgKGVyciwgcmVzKT0+e1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcykgcmV0dXJuIGRvbmUobnVsbCwgZmFsc2UsIHsgbWVzc2FnZTogJ0luY29ycmVjdCBwYXNzd29yZC4nIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9uZShudWxsLCB1c2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgKSk7XG5cblxuXG5cbn07Il19